<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="./img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Communications - Evennia Manual</title>
    <link href="./css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="./css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="./css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/bootstrap-3.3.7.min.js"></script>
    <script src="./js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '.';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Msg", url: "#_top", children: [
              {title: "Properties defined on Msg", url: "#properties-defined-on-msg" },
          ]},
          {title: "TempMsg", url: "#tempmsg", children: [
          ]},
          {title: "Channels", url: "#channels", children: [
              {title: "Properties defined on Channel", url: "#properties-defined-on-channel" },
          ]},
        ];

    </script>
    <script src="./js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <p><a href="How-to-code-with-Channels,-Messages-and-other-systems-for-sending-info-to-others."></a></p>
<p>Apart from moving around in the game world and talking, players might need other forms of communication. This is offered by Evennia's <code>Comm</code> system. Stock evennia implements a 'MUX-like' system of channels, but there is nothing stopping you from changing things to better suit your taste. </p>
<p>Comms rely on two main database objects - <code>Msg</code> and <code>Channel</code>. There is also the <code>TempMsg</code> which mimics the API of a <code>Msg</code> but has no connection to the database.</p>
<h2 id="msg">Msg<a class="headerlink" href="#msg" title="Permanent link">&para;</a></h2>
<p>The <code>Msg</code> object is the basic unit of communication in Evennia. A message works a little like an e-mail; it always has a sender (a <a href="Accounts">Account</a>) and one or more recipients. The recipients may be either other Accounts, or a <em>Channel</em> (see below). You can mix recipients to send the message to both Channels and Accounts if you like.</p>
<p>Once created, a <code>Msg</code> is normally not changed. It is peristently saved in the database. This allows for comprehensive logging of communications. This could be useful for allowing senders/receivers to have 'mailboxes' with the messages they want to keep. </p>
<h3 id="properties-defined-on-msg">Properties defined on <code>Msg</code><a class="headerlink" href="#properties-defined-on-msg" title="Permanent link">&para;</a></h3>
<ul>
<li><code>senders</code> - this is a reference to one or many <a href="Accounts">Account</a> or <a href="Objects">Objects</a> (normally <em>Characters</em>) sending the message.  This could also be an <em>External Connection</em> such as a message coming in over IRC/IMC2 (see below). There is usually only one sender, but the types can also be mixed in any combination.</li>
<li><code>receivers</code> - a list of target <a href="Accounts">Accounts</a>, <a href="Objects">Objects</a> (usually <em>Characters</em>) or <em>Channels</em> to send the message to. The types of receivers can be mixed in any combination.</li>
<li><code>header</code> - this is a text field for storing a title or header for the message. </li>
<li><code>message</code> - the actual text being sent.</li>
<li><code>date_sent</code> - when message was sent (auto-created).</li>
<li><code>locks</code> - a <a href="Locks">lock definition</a>.</li>
<li><code>hide_from</code> - this can optionally hold a list of objects, accounts or channels to hide this <code>Msg</code> from. This relationship is stored in the database primarily for optimization reasons, allowing for quickly post-filter out messages not intended for a given target.  There is no in-game methods for setting this, it's intended to be done in code.</li>
</ul>
<p>You create new messages in code using <code>evennia.create_message</code> (or <code>evennia.utils.create.create_message.</code>) </p>
<h2 id="tempmsg">TempMsg<a class="headerlink" href="#tempmsg" title="Permanent link">&para;</a></h2>
<p><code>evennia.comms.models</code> also has <code>TempMsg</code> which mimics the API of <code>Msg</code> but is not connected to the database. TempMsgs are used by Evennia for channel messages by default. They can be used for any system expecting a <code>Msg</code> but when you don't actually want to save anything. </p>
<h2 id="channels">Channels<a class="headerlink" href="#channels" title="Permanent link">&para;</a></h2>
<p>Channels are <a href="Typeclasses">Typeclassed</a> entities, which mean they can be easily extended and their functionality modified. To change which channel typeclass Evennia uses, change settings.BASE_CHANNEL_TYPECLASS.</p>
<p>Channels act as generic distributors of messages. Think of them as "switch boards" redistributing <code>Msg</code> or <code>TempMsg</code> objects. Internally they hold a list of "listening" objects and any <code>Msg</code> (or <code>TempMsg</code>) sent to the channel will be distributed out to all channel listeners. Channels have <a href="Locks">Locks</a> to limit who may listen and/or send messages through them. </p>
<p>The <em>sending</em> of text to a channel is handled by a dynamically created <a href="Commands">Command</a> that always have the same name as the channel. This is created for each channel by the global <code>ChannelHandler</code>. The Channel command is added to the Account's cmdset and normal command locks are used to determine which channels are possible to write to. When subscribing to a channel, you can then just write the channel name and the text to send. </p>
<p>The default ChannelCommand (which can be customized by pointing <code>settings.CHANNEL_COMMAND_CLASS</code> to your own command), implements a few convenient features: </p>
<ul>
<li>It only sends <code>TempMsg</code> objects. Instead of storing individual entries in the database it instead dumps channel output a file log in <code>server/logs/channel_&lt;channelname&gt;.log</code>. This is mainly for practical reasons - we find one rarely need to query individual Msg objects at a later date. Just stupidly dumping the log to a file also means a lot less database overhead. </li>
<li>It adds a <code>/history</code> switch to view the 20 last messages in the channel. These are read from the end of the log file. One can also supply a line number to start further back in the file (but always 20 entries at a time). It's used like this: <pre><code>&gt; public/history 
&gt; public/history 35
</code></pre>
</li>
</ul>
<p>There are two default channels created in stock Evennia - <code>MudInfo</code> and <code>Public</code>.  <code>MudInfo</code> receives server-related messages meant for Admins whereas <code>Public</code>  is open to everyone to chat on (all new accounts are automatically joined to it when logging in, it is useful for asking questions). The default channels are defined by the <code>DEFAULT_CHANNELS</code> list (see <code>evennia/settings_default.py</code> for more details).</p>
<p>You create new channels with <code>evennia.create_channel</code> (or <code>evennia.utils.create.create_channel</code>).</p>
<p>In code, messages are sent to a channel using the <code>msg</code> or <code>tempmsg</code> methods of channels: </p>
<pre><code> channel.msg(msgobj, header=None, senders=None, persistent=True)
</code></pre>
<p>The argument <code>msgobj</code> can be either a string, a previously constructed <code>Msg</code> or a <code>TempMsg</code> - in the latter cases all the following keywords are ignored since the message objects already contains all this information. If <code>msgobj</code> is a string, the other keywords are used for creating a new <code>Msg</code> or <code>TempMsg</code> on the fly, depending on if <code>persistent</code> is set or not. By default, a <code>TempMsg</code> is emitted for channel communication (since the default ChannelCommand instead logs to a file). </p>
<pre><code class="python">    # assume we have a 'sender' object and a channel named 'mychan'

    # manually sending a message to a channel
    mychan.msg(&quot;Hello!&quot;, senders=[sender])
</code></pre>

<h3 id="properties-defined-on-channel">Properties defined on <code>Channel</code><a class="headerlink" href="#properties-defined-on-channel" title="Permanent link">&para;</a></h3>
<ul>
<li><code>key</code> - main name for channel</li>
<li><code>aliases</code> - alternative native names for channels</li>
<li><code>desc</code> - optional description of channel (seen in listings)</li>
<li><code>keep_log</code> (bool) - if the channel should store messages (default)</li>
<li><code>locks</code> - A <a href="Locks">lock definition</a>. Channels normally use the access_types <code>send, control</code> and <code>listen</code>.</li>
</ul>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>