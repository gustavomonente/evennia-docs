<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="./img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Updating Your Game - Evennia Manual</title>
    <link href="./css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="./css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="./css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/bootstrap-3.3.7.min.js"></script>
    <script src="./js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '.';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Updating with the latest Evennia code changes", url: "#_top", children: [
          ]},
          {title: "Upgrading Evennia dependencies", url: "#upgrading-evennia-dependencies", children: [
          ]},
          {title: "Migrating the Database Schema", url: "#migrating-the-database-schema", children: [
          ]},
          {title: "Resetting your database", url: "#resetting-your-database", children: [
          ]},
          {title: "More about schema migrations", url: "#more-about-schema-migrations", children: [
          ]},
        ];

    </script>
    <script src="./js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <p><a href="Describes-how-to-update-the-source-from-the-repo-and-how-to-reset-the-database."></a></p>
<p>Fortunately, it's extremely easy to keep your Evennia server up-to-date. If you haven't already, see the <a href="Getting-Started">Getting Started guide</a> and get everything running. </p>
<h3 id="updating-with-the-latest-evennia-code-changes">Updating with the latest Evennia code changes<a class="headerlink" href="#updating-with-the-latest-evennia-code-changes" title="Permanent link">&para;</a></h3>
<p>Very commonly we make changes to the Evennia code to improve things. There are many ways to get told when to update: You can subscribe to the RSS feed or manually check up on the feeds from http://www.evennia.com. You can also simply fetch the latest regularly.  </p>
<p>When you're wanting to apply updates, simply <code>cd</code> to your cloned <code>evennia</code> root directory and type:</p>
<pre><code> git pull
</code></pre>
<p>assuming you've got the command line client. If you're using a graphical client, you will probably want to navigate to the <code>evennia</code> directory and either right click and find your client's pull function, or use one of the menus (if applicable).</p>
<p>You can review the latest changes with</p>
<pre><code> git log
</code></pre>
<p>or the equivalent in the graphical client. You can also see the latest changes online <a href="https://github.com/evennia/evennia/blob/master/CHANGELOG.md">here</a>.</p>
<p>You will always need to do <code>evennia reload</code> (or <code>reload</code> from -in-game) from your game-dir to have the new code affect your game. If you want to be really sure you should run a full <code>evennia reboot</code> so that both Server and Portal can restart (this will disconnect everyone though, so if you know the Portal has had no updates you don't have to do that). </p>
<h3 id="upgrading-evennia-dependencies">Upgrading Evennia dependencies<a class="headerlink" href="#upgrading-evennia-dependencies" title="Permanent link">&para;</a></h3>
<p>On occasion we update the versions of third-party libraries Evennia depend on (or we may add a new dependency). This will be announced on the mailing list/forum. If you run into errors when starting Evennia, always make sure you have the latest versions of everything. In some cases, like for Django, starting the server may also give warning saying that you are using a working, but too-old version that should not be used in production.</p>
<p>Upgrading <code>evennia</code> will automatically fetch all the latest packages that it now need. First <code>cd</code> to your cloned <code>evennia</code> folder. Make sure your <code>virtualenv</code> is active and use</p>
<pre><code>pip install --upgrade -e .
</code></pre>
<p>Remember the period (<code>.</code>) at the end - that applies the upgrade to the current location (your <code>evennia</code> dir). </p>
<blockquote>
<p>The <code>-e</code> means that we are <em>linking</em> the evennia sources rather than copying them into the environment. This means we can most of the time just update the sources (with <code>git pull</code>) and see those changes directly applied to our installed <code>evennia</code> package. Without installing/upgrading the package with <code>-e</code>, we would have to remember to upgrade the package every time we downloaded any new source-code changes. </p>
</blockquote>
<p>Follow the upgrade output to make sure it finishes without errors. To check what packages are currently available in your python environment after the upgrade, use </p>
<pre><code>pip list
</code></pre>
<p>This will show you the version of all installed packages. The <code>evennia</code> package will also show the location of its source code.</p>
<h2 id="migrating-the-database-schema">Migrating the Database Schema<a class="headerlink" href="#migrating-the-database-schema" title="Permanent link">&para;</a></h2>
<p>Whenever we change the database layout of Evennia upstream (such as when we add new features) you will need to <em>migrate</em> your existing database. When this happens it will be clearly noted in the <code>git log</code> (it will say something to the effect of "Run migrations"). Database changes will also be announced on the Evennia <a href="https://groups.google.com/forum/#!forum/evennia">mailing list</a>. </p>
<p>When the database schema changes, you just go to your game folder and run</p>
<pre><code> evennia migrate
</code></pre>
<blockquote>
<p>Hint: If the <code>evennia</code> command is not found, you most likely need to activate your <a href="Glossary#virtualenv">virtualenv</a>.</p>
</blockquote>
<h2 id="resetting-your-database">Resetting your database<a class="headerlink" href="#resetting-your-database" title="Permanent link">&para;</a></h2>
<p>Should you ever want to start over completely from scratch, there is no need to re-download Evennia or anything like that. You just need to clear your database. Once you are done, you just rebuild it from scratch as described in <a href="Getting-Started#step-2-setting-up-your-game">step 2</a> of the <a href="Getting-Started">Getting Started guide</a>.</p>
<p>First stop a running server with</p>
<pre><code>evennia stop
</code></pre>
<p>If you run the default <code>SQlite3</code> database (to change this you need to edit your <code>settings.py</code> file), the database is actually just a normal file in <code>mygame/server/</code> called <code>evennia.db3</code>. <em>Simply delete that file</em> - that's it. Now run <code>evennia migrate</code> to recreate a new, fresh one. </p>
<p>If you run some other database system you can instead flush the database:</p>
<pre><code>evennia flush
</code></pre>
<p>This will empty the database. However, it will not reset the internal counters of the database, so you will start with higher dbref values. If this is okay, this is all you need. </p>
<p>Django also offers an easy way to start the database's own management should we want more direct control:</p>
<pre><code> evennia dbshell
</code></pre>
<p>In e.g. MySQL you can then do something like this (assuming your MySQL database is named "Evennia":</p>
<pre><code>mysql&gt; DROP DATABASE Evennia;
mysql&gt; exit
</code></pre>
<blockquote>
<p>NOTE: Under Windows OS, in order to access SQLite dbshell you need to <a href="https://www.sqlite.org/download.html">download the SQLite command-line shell program</a>. It's a single executable file (sqlite3.exe) that you should place in the root of either your MUD folder or Evennia's (it's the same, in both cases Django will find it).</p>
</blockquote>
<h2 id="more-about-schema-migrations">More about schema migrations<a class="headerlink" href="#more-about-schema-migrations" title="Permanent link">&para;</a></h2>
<p>If and when an Evennia update modifies the database <em>schema</em> (that is, the under-the-hood details as to how data is stored in the database), you must update your existing database correspondingly to match the change. If you don't, the updated Evennia will complain that it cannot read the database properly. Whereas schema changes should become more and more rare as Evennia matures, it may still happen from time to time.</p>
<p>One way one could handle this is to apply the changes manually to your database using the database's command line. This often means adding/removing new tables or fields as well as possibly convert existing data to match what the new Evennia version expects. It should be quite obvious that this quickly becomes cumbersome and error-prone.  If your database doesn't contain anything critical yet it's probably easiest to simply reset it and start over rather than to bother converting.</p>
<p>Enter <em>migrations</em>. Migrations keeps track of changes in the database schema and applies them automatically for you. Basically, whenever the schema changes we distribute small files called "migrations" with the source. Those tell the system exactly how to implement the change so you don't have to do so manually. When a migration has been added we will tell you so on Evennia's mailing lists and in commit messages -
you then just run <code>evennia migrate</code> to be up-to-date again. </p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>