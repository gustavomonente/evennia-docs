<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="./img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Start Stop Reload - Evennia Manual</title>
    <link href="./css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="./css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="./css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/bootstrap-3.3.7.min.js"></script>
    <script src="./js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '.';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Starting Evennia", url: "#_top", children: [
          ]},
          {title: "Foreground mode", url: "#foreground-mode", children: [
          ]},
          {title: "Reloading", url: "#reloading", children: [
          ]},
          {title: "Resetting", url: "#resetting", children: [
          ]},
          {title: "Rebooting", url: "#rebooting", children: [
          ]},
          {title: "Shutting down", url: "#shutting-down", children: [
          ]},
          {title: "Status and info", url: "#status-and-info", children: [
          ]},
          {title: "Killing (Linux/Mac only)", url: "#killing-linuxmac-only", children: [
          ]},
          {title: "Django options", url: "#django-options", children: [
          ]},
          {title: "Advanced handling of Evennia processes", url: "#advanced-handling-of-evennia-processes", children: [
              {title: "Syntax errors during live development", url: "#syntax-errors-during-live-development" },
          ]},
        ];

    </script>
    <script src="./js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <p><a href="How-to-control-the-Server-and-Portal-process-from-the-terminal-and-inside-the-game."></a></p>
<p>You control Evennia from your game folder (we refer to it as <code>mygame/</code> here), using the <code>evennia</code>
program. If the <code>evennia</code> program is not available on the command line you must first install
Evennia as described in the <a href="Getting-Started">Getting Started</a> page.</p>
<blockquote>
<p>Hint: If you ever try the <code>evennia</code> command and get an error complaining that the command is not available, make sure your <a href="Glossary#virtualenv">virtualenv</a> is active. </p>
</blockquote>
<p>Below are described the various management options. Run</p>
<pre><code>evennia -h
</code></pre>
<p>to give you a brief help and</p>
<pre><code>evennia menu
</code></pre>
<p>to give you a menu with options.</p>
<h2 id="starting-evennia">Starting Evennia<a class="headerlink" href="#starting-evennia" title="Permanent link">&para;</a></h2>
<p>Evennia consists of two components, the Evennia <a href="Portal-And-Server">Server and Portal</a>.  Briefly,
the  <em>Server</em> is what is running the mud. It handles all game-specific things but doesn't care
exactly how players connect, only that they have. The <em>Portal</em> is a gateway to which players
connect. It knows everything about telnet, ssh, webclient protocols etc but very little about the
game. Both are required for a functioning mud.</p>
<pre><code> evennia start
</code></pre>
<p>The above command will start the Portal, which in turn will boot up the Server. The command will
print a summary of the process and unless there is an error you will see no further output. Both
components will instead log to log files in <code>mygame/server/logs/</code>. For convenience you can follow
those logs directly in your terminal by attaching <code>-l</code> to commands:</p>
<pre><code> evennia -l
</code></pre>
<p>Will start following the logs of an already running server. When starting Evennia you can also do</p>
<pre><code> evennia start -l
</code></pre>
<blockquote>
<p>To stop viewing the log files, press <code>Ctrl-C</code>.</p>
</blockquote>
<h2 id="foreground-mode">Foreground mode<a class="headerlink" href="#foreground-mode" title="Permanent link">&para;</a></h2>
<p>Normally, Evennia runs as a 'daemon', in the background. If you want you can start either of the
processes (but not both) as foreground processes in <em>interactive</em> mode. This means they will log
directly to the terminal (rather than to log files that we then echo to the terminal) and you can
kill the process (not just the log-file view) with <code>Ctrl-C</code>.</p>
<pre><code>evennia istart
</code></pre>
<p>will start/restart the <em>Server</em> in interactive mode. This is required if you want to run a
<em>debugger</em>. Next time you reload the server, it will return to normal mode.</p>
<pre><code>evennia ipstart
</code></pre>
<p>will start the <em>Portal</em> in interactive mode. This is usually only necessary if you want to run
Evennia under the control of some other type of process.</p>
<h2 id="reloading">Reloading<a class="headerlink" href="#reloading" title="Permanent link">&para;</a></h2>
<p>The act of <em>reloading</em> means the Portal will tell the Server to shut down and then boot it back up
again. Everyone will get a message and the game will be briefly paused for all accounts as the server
reboots. Since they are connected to the <em>Portal</em>, their connections are not lost.</p>
<p>Reloading is as close to a "warm reboot" you can get. It reinitializes all code of Evennia, but
doesn't kill "persistent" <a href="Scripts">Scripts</a>. It also calls <code>at_server_reload()</code> hooks on all objects so you
can save eventual temporary properties you want.</p>
<p>From in-game the <code>@reload</code> command is used. You can also reload the server from outside the game:</p>
<pre><code> evennia reload
</code></pre>
<p>Sometimes reloading from "the outside" is necessary in case you have added some sort of bug that
blocks in-game input.</p>
<h2 id="resetting">Resetting<a class="headerlink" href="#resetting" title="Permanent link">&para;</a></h2>
<p><em>Resetting</em> is the equivalent of a "cold reboot" - the Server will shut down and then restarted
again, but will behave as if it was fully shut down. As opposed to a "real" shutdown, no accounts will be disconnected during a
reset. A reset will however purge all non-persistent scripts and will call <code>at_server_shutdown()</code>
hooks. It can be a good way to clean unsafe scripts during development, for example.</p>
<p>From in-game the <code>@reset</code> command is used. From the terminal:</p>
<pre><code>evennia reset
</code></pre>
<h2 id="rebooting">Rebooting<a class="headerlink" href="#rebooting" title="Permanent link">&para;</a></h2>
<p>This will shut down <em>both</em> Server and Portal, which means all connected players will loose their
connection. It can only be initiated from the terminal:</p>
<pre><code>evennia reboot
</code></pre>
<p>This is identical to doing these two commands:</p>
<pre><code> evennia stop
 evennia start
</code></pre>
<h2 id="shutting-down">Shutting down<a class="headerlink" href="#shutting-down" title="Permanent link">&para;</a></h2>
<p>A full shutdown closes Evennia completely, both Server and Portal. All accounts will be booted and
systems saved and turned off cleanly.</p>
<p>From inside the game you initiate a shutdown with the <code>@shutdown</code> command.  From command line you do</p>
<pre><code> evennia stop
</code></pre>
<p>You will see messages of both Server and Portal closing down. All accounts will see the shutdown
message and then be disconnected. The same effect happens if you press <code>Ctrl+C</code> while the server
runs in interactive mode.</p>
<h2 id="status-and-info">Status and info<a class="headerlink" href="#status-and-info" title="Permanent link">&para;</a></h2>
<p>To check basic Evennia settings, such as which ports and services are active, this will repeat the
initial return given when starting the server:</p>
<pre><code>evennia info
</code></pre>
<p>You can also get a briefer run-status from both components with this command</p>
<pre><code>evennia status
</code></pre>
<p>This can be useful for automating checks to make sure the game is running and is responding.</p>
<h2 id="killing-linuxmac-only">Killing (Linux/Mac only)<a class="headerlink" href="#killing-linuxmac-only" title="Permanent link">&para;</a></h2>
<p>In the extreme case that neither of the server processes locks up and does not respond to commands,
you can send them kill-signals to force them to shut down. To kill only the Server:</p>
<pre><code>evennia skill
</code></pre>
<p>To kill both Server and Portal:</p>
<pre><code>evennia kill
</code></pre>
<p>Note that this functionality is not supported on Windows.</p>
<h2 id="django-options">Django options<a class="headerlink" href="#django-options" title="Permanent link">&para;</a></h2>
<p>The <code>evennia</code> program will also pass-through options used by the <code>django-admin</code>. These operate on the database in various ways.</p>
<pre><code class="bash">
 evennia migrate # migrate the database
 evennia shell   # launch an interactive, django-aware python shell
 evennia dbshell # launch database shell

</code></pre>

<p>For (many) more options, see <a href="https://docs.djangoproject.com/en/1.7/ref/django-admin/#usage">the django-admin docs</a>.</p>
<h2 id="advanced-handling-of-evennia-processes">Advanced handling of Evennia processes<a class="headerlink" href="#advanced-handling-of-evennia-processes" title="Permanent link">&para;</a></h2>
<p>If you should need to manually manage Evennia's processors (or view them in a task manager program
such as Linux' <code>top</code> or the more advanced <code>htop</code>), you will find the following processes to be
related to Evennia:</p>
<ul>
<li>1 x <code>twistd ... evennia/server/portal/portal.py</code> - this is the Portal process.</li>
<li>3 x <code>twistd ... server.py</code> - One of these processes manages Evennia's Server component, the main
  game. The other processes (with the same name but different process id) handle's Evennia's
  internal web server threads. You can look at <code>mygame/server/server.pid</code> to determine which is the
  main process.</li>
</ul>
<h3 id="syntax-errors-during-live-development">Syntax errors during live development<a class="headerlink" href="#syntax-errors-during-live-development" title="Permanent link">&para;</a></h3>
<p>During development, you will usually modify code and then reload the server to see your changes.
This is done by Evennia re-importing your custom modules from disk. Usually bugs in a module will
just have you see a traceback in the game, in the log or on the command line.  For some really
serious syntax errors though, your module might not even be recognized as valid Python. Evennia may
then fail to restart correctly.</p>
<p>From inside the game you see a text about the Server restarting followed by an ever growing list of
"...". Usually this only lasts a very short time (up to a few seconds). If it seems to go on, it
means the Portal is still running (you are still connected to the game) but the Server-component of
Evennia failed to restart (that is, it remains in a shut-down state). Look at your log files or
terminal to see what the problem is - you will usually see a clear traceback showing what went
wrong.</p>
<p>Fix your bug then run</p>
<pre><code>evennia start
</code></pre>
<p>Assuming the bug was fixed, this will start the Server manually (while not restarting the Portal).
In-game you should now get the message that the Server has successfully restarted.</p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>