<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="./img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Default Exit Errors - Evennia Manual</title>
    <link href="./css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="./css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="./css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/bootstrap-3.3.7.min.js"></script>
    <script src="./js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '.';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Adding default error commands", url: "#_top", children: [
          ]},
          {title: "Additional Comments", url: "#additional-comments", children: [
          ]},
        ];

    </script>
    <script src="./js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <p><a href="A-tutorial-for-changing-what-error-you-get-when-walking-in-a-non-existing-direction."></a></p>
<p>Evennia allows for exits to have any name. The command "kitchen" is a valid exit name as well as "jump out the window" or "north". An exit actually consists of two parts: an <a href="Objects">Exit Object</a> and an <a href="Commands">Exit Command</a> stored on said exit object. The command has the same key and aliases as the object, which is why you can see the exit in the room and just write its name to traverse it.</p>
<p>If you try to enter the name of a non-existing exit, it is thus the same as trying a non-exising command; Evennia doesn't care about the difference: </p>
<pre><code> &gt; jump out the window
 Command 'jump out the window' is not available. Type "help" for help.
</code></pre>
<p>Many games don't need this type of freedom however. They define only the cardinal directions as valid exit names (Evennia's <code>@tunnel</code> command also offers this functionality). In this case, the error starts to look less logical: </p>
<pre><code> &gt; west
 Command 'west' is not available. Maybe you meant "@set" or "@reset"?
</code></pre>
<p>Since we for our particular game <em>know</em> that west is an exit direction, it would be better if the error message just told us that we couldn't go there. </p>
<h2 id="adding-default-error-commands">Adding default error commands<a class="headerlink" href="#adding-default-error-commands" title="Permanent link">&para;</a></h2>
<p>To solve this you need to be aware of how to <a href="Adding-Command-Tutorial">write and add new commands</a>. What you need to do is to create new commands for all directions you want to support in your game. In this example all we'll do is echo an error message, but you could certainly consider more advanced uses. You add these commands to the default command set. Here is an example of such a set of commands: </p>
<pre><code class="python"># for example in a file mygame/commands/movecommands.py

from evennia import default_cmds

class CmdExitError(default_cmds.MuxCommand):
    &quot;Parent class for all exit-errors.&quot;        
    locks = &quot;cmd:all()&quot;
    arg_regex = r&quot;\s|$&quot;
    auto_help = False
    def func(self):
        &quot;returns the error&quot;
        self.caller.msg(&quot;You cannot move %s.&quot; % self.key)   

class CmdExitErrorNorth(CmdExitError):
    key = &quot;north&quot;
    aliases = [&quot;n&quot;]

class CmdExitErrorEast(CmdExitError):
    key = &quot;east&quot;
    aliases = [&quot;e&quot;]

class CmdExitErrorSouth(CmdExitError):
    key = &quot;south&quot;
    aliases = [&quot;s&quot;]

class CmdExitErrorWest(CmdExitError):
    key = &quot;west&quot;
    aliases = [&quot;w&quot;]
</code></pre>

<p>Make sure to add the directional commands (not their parent) to the <code>CharacterCmdSet</code> class in <code>mygame/commands/default_cmdsets.py</code>:</p>
<pre><code class="python"># in mygame/commands/default_cmdsets.py

from commands import movecommands

# [...]
class CharacterCmdSet(default_cmds.CharacterCmdSet):
    # [...]
    def at_cmdset_creation(self):
        # [...]
        self.add(movecommands.CmdExitErrorNorth())
        self.add(movecommands.CmdExitErrorEast()) 
        self.add(movecommands.CmdExitErrorSouth())
        self.add(movecommands.CmdExitErrorWest())
</code></pre>

<p>After a <code>@reload</code> these commands (assuming you don't get any errors - check your log) will be loaded. What happens henceforth is that if you are in a room with an Exitobject (let's say it's "north"), the proper Exit-command will overload your error command (also named "north"). But if you enter an direction without having a matching exit for it, you will fallback to your default error commands: </p>
<pre><code> &gt; east
 You cannot move east.
</code></pre>
<p>Further expansions by the exit system (including manipulating the way the Exit command itself is created) can be done by modifying the <a href="Typeclasses">Exit typeclass</a> directly.</p>
<h2 id="additional-comments">Additional Comments<a class="headerlink" href="#additional-comments" title="Permanent link">&para;</a></h2>
<p>So why didn't we create a single error command above? Something like this: </p>
<pre><code class="python">     class CmdExitError(default_cmds.MuxCommand):
        &quot;Handles all exit-errors.&quot;
        key = &quot;error_cmd&quot;
        aliases = [&quot;north&quot;, &quot;n&quot;, 
                   &quot;east&quot;, &quot;e&quot;,
                   &quot;south&quot;, &quot;s&quot;,
                   &quot;west&quot;, &quot;w&quot;]
         #[...]
</code></pre>

<p>The anwer is that this would <em>not</em> work and understanding why is important in order to not be confused when working with commands and command sets. </p>
<p>The reason it doesn't work is because Evennia's <a href="Commands">command system</a> compares commands <em>both</em> by <code>key</code> and by <code>aliases</code>.  If <em>either</em> of those match, the two commands are considered <em>identical</em> as far as cmdset merging system is concerned.</p>
<p>So the above example would work fine as long as there were no Exits at all in the room. But what happens when we enter a room with an exit "north"? The Exit's cmdset is merged onto the default one, and since there is an alias match, the system determines our <code>CmdExitError</code> to be identical. It is thus overloaded by the Exit command (which also correctly defaults to a higher priority). The result is that you can go through the north exit normally but none of the error messages for the other directions are available since the single error command was completely overloaded by the single matching "north" exit-command. </p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>