<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Add a wiki on your website - Evennia Manual</title>
        <link href="css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">Evennia Manual</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="index.html">Home</a>
                            </li>
                            <li >
                                <a href="Administrative-Docs.html">Admin</a>
                            </li>
                            <li >
                                <a href="Builder-Docs.html">Building</a>
                            </li>
                            <li >
                                <a href="Developer-Central.html">Game Development</a>
                            </li>
                            <li >
                                <a href="Tutorials.html">Tutorials</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#basic-installation">Basic installation</a></li>
            <li><a href="#installing-with-pip">Installing with pip</a></li>
            <li><a href="#adding-the-wiki-in-the-settings">Adding the wiki in the settings</a></li>
            <li><a href="#adding-the-new-urls">Adding the new URLs</a></li>
            <li><a href="#running-migrations">Running migrations</a></li>
        <li class="main "><a href="#customizing-privileges">Customizing privileges</a></li>
            <li><a href="#managing-wiki-pages-from-evennia">Managing wiki pages from Evennia</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><a href="Add-a-wiki-on-your-website-through-Django-wiki"></a></p>
<p><strong>Before doing this tutorial you will probably want to read the intro in 
<a href="Web-Tutorial">Basic Web tutorial</a>.</strong>  Reading the three first parts of the 
<a href="https://docs.djangoproject.com/en/1.9/intro/tutorial01/">Django tutorial</a> might help as well.</p>
<p>This tutorial will provide a step-by-step process to installing a wiki on your website.
Fortunately, you don't have to create the features manually, since it has been done by others, and
we can integrate their work quite easily with Django.  I have decided to focus on
the <a href="http://django-wiki.readthedocs.io/">Django-wiki</a>.</p>
<blockquote>
<p>Note: this article has been updated for Evennia 0.9.  If you're not yet using this version, be careful, as the django wiki doesn't support Python 2 anymore.  (Remove this note when enough time has passed.)</p>
</blockquote>
<p>The <a href="http://django-wiki.readthedocs.io/">Django-wiki</a> offers a lot of features associated with wikis, is
actively maintained (at this time, anyway), and isn't too difficult to install in Evennia.  You can
see a <a href="https://demo.django.wiki">demonstration of Django-wiki here</a>.</p>
<h2 id="basic-installation">Basic installation<a class="headerlink" href="#basic-installation" title="Permanent link">&para;</a></h2>
<p>You should begin by shutting down the Evennia server if it is running.  We will run migrations and
alter the virtual environment just a bit.  Open a terminal and activate your Python environment, the
one you use to run the <code>evennia</code> command.</p>
<ul>
<li>On Linux:
    <code>source evenv/bin/activate</code></li>
<li>Or Windows:
    <code>evenv\bin\activate</code></li>
</ul>
<h3 id="installing-with-pip">Installing with pip<a class="headerlink" href="#installing-with-pip" title="Permanent link">&para;</a></h3>
<p>Install the wiki using pip:</p>
<pre><code>pip install wiki
</code></pre>
<blockquote>
<p>Note: this will install the last version of Django wiki. Version &gt;0.4 doesn't support Python 2, so install wiki 0.3 if you haven't updated to Python 3 yet.</p>
</blockquote>
<p>It might take some time, the Django-wiki having some dependencies.</p>
<h3 id="adding-the-wiki-in-the-settings">Adding the wiki in the settings<a class="headerlink" href="#adding-the-wiki-in-the-settings" title="Permanent link">&para;</a></h3>
<p>You will need to add a few settings to have the wiki app on your website.  Open your
<code>server/conf/settings.py</code> file and add the following at the bottom (but before importing <code>secret_settings</code>).  Here's what you'll find in my own setting file (add the whole Django-wiki section):</p>
<pre><code class="python">r&quot;&quot;&quot;
Evennia settings file.

...

&quot;&quot;&quot;

# Use the defaults from Evennia unless explicitly overridden
from evennia.settings_default import *

######################################################################
# Evennia base server config
######################################################################

# This is the name of your game. Make it catchy!
SERVERNAME = &quot;demowiki&quot;

######################################################################
# Django-wiki settings
######################################################################
INSTALLED_APPS += (
    'django.contrib.humanize.apps.HumanizeConfig',
    'django_nyt.apps.DjangoNytConfig',
    'mptt',
    'sorl.thumbnail',
    'wiki.apps.WikiConfig',
    'wiki.plugins.attachments.apps.AttachmentsConfig',
    'wiki.plugins.notifications.apps.NotificationsConfig',
    'wiki.plugins.images.apps.ImagesConfig',
    'wiki.plugins.macros.apps.MacrosConfig',
)

# Disable wiki handling of login/signup
WIKI_ACCOUNT_HANDLING = False
WIKI_ACCOUNT_SIGNUP_ALLOWED = False

######################################################################
# Settings given in secret_settings.py override those in this file.
######################################################################
try:
    from server.conf.secret_settings import *
except ImportError:
    print(&quot;secret_settings.py file not found or failed to import.&quot;)
</code></pre>

<h3 id="adding-the-new-urls">Adding the new URLs<a class="headerlink" href="#adding-the-new-urls" title="Permanent link">&para;</a></h3>
<p>Next we need to add two URLs in our <code>web/urls.py</code> file.  Open it and compare the following output:
you will need to add two URLs in <code>custom_patterns</code> and add one import line:</p>
<pre><code class="python">from django.conf.urls import url, include
from django.urls import path # NEW!

# default evenni    a patterns
from evennia.web.urls import urlpatterns

# eventual custom patterns
custom_patterns = [
    # url(r'/desired/url/', view, name='example'),
    url('notifications/', include('django_nyt.urls')), # NEW!
    url('wiki/', include('wiki.urls')), # NEW!
]

# this is required by Django.
urlpatterns = custom_patterns + urlpatterns
</code></pre>

<p>You will probably need to copy line 2, 10, and 11.  Be sure to place them correctly, as shown in
the example above.</p>
<h3 id="running-migrations">Running migrations<a class="headerlink" href="#running-migrations" title="Permanent link">&para;</a></h3>
<p>It's time to run the new migrations.  The wiki app adds a few tables in our database.  We'll need to
run:</p>
<pre><code>evennia migrate
</code></pre>
<p>And that's it, you can start the server.  If you go to http://localhost:4001/wiki , you should see
the wiki.  Use your account's username and password to connect to it.  That's how simple it is.</p>
<h2 id="customizing-privileges">Customizing privileges<a class="headerlink" href="#customizing-privileges" title="Permanent link">&para;</a></h2>
<p>A wiki can be a great collaborative tool, but who can see it?  Who can modify it?  Django-wiki comes
with a privilege system centered around four values per wiki page.  The owner of an article can
always read and write in it (which is somewhat logical).  The group of the article defines who can
read and who can write, if the user seeing the page belongs to this group.  The topic of groups in
wiki pages will not be discussed here.  A last setting determines which other user (that is, these
who aren't in the groups, and aren't the article's owner) can read and write.  Each article has
these four settings (group read, group write, other read, other write).  Depending on your purpose,
it might not be a good default choice, particularly if you have to remind every builder to keep the
pages private.  Fortunately, Django-wiki gives us additional settings to customize who can read, and
who can write, a specific article.</p>
<p>These settings must be placed, as usual, in your <code>server/conf/settings.py</code> file.  They take a
function as argument, said function (or callback) will be called with the article and the user.
Remember, a Django user, for us, is an account.  So we could check lockstrings on them if needed.
Here is a default setting to restrict the wiki: only builders can write in it, but anyone (including non-logged in users) can read it.  The superuser has some additional privileges.</p>
<pre><code class="python"># In server/conf/settings.py
# ...

def is_superuser(article, user):
    &quot;&quot;&quot;Return True if user is a superuser, False otherwise.&quot;&quot;&quot;
    return not user.is_anonymous() and user.is_superuser

def is_builder(article, user):
    &quot;&quot;&quot;Return True if user is a builder, False otherwise.&quot;&quot;&quot;
    return not user.is_anonymous() and user.locks.check_lockstring(user, &quot;perm(Builders)&quot;)

def is_anyone(article, user):
    &quot;&quot;&quot;Return True even if the user is anonymous.&quot;&quot;&quot;
    return True

# Who can create new groups and users from the wiki?
WIKI_CAN_ADMIN = is_superuser
# Who can change owner and group membership?
WIKI_CAN_ASSIGN = is_superuser
# Who can change group membership?
WIKI_CAN_ASSIGN_OWNER = is_superuser
# Who can change read/write access to groups or others?
WIKI_CAN_CHANGE_PERMISSIONS = is_superuser
# Who can soft-delete an article?
WIKI_CAN_DELETE = is_builder
# Who can lock an article and permanently delete it?
WIKI_CAN_MODERATE = is_superuser
# Who can edit articles?
WIKI_CAN_WRITE = is_builder
# Who can read articles?
WIKI_CAN_READ = is_anyone
</code></pre>

<p>Here, we have created three functions: one to return <code>True</code> if the user is the superuser, one to
return <code>True</code> if the user is a builder, one to return <code>True</code> no matter what (this includes if the user is anonymous, E.G. if it's not logged-in).  We then change settings to allow either the superuser or
each builder to moderate, read, write, delete, and more.  You can, of course, add more functions,
adapting them to your need.  This is just a demonstration.</p>
<p>Providing the <code>WIKI_CAN*...</code> settings will bypass the original permission system.  The superuser
could change permissions of an article, but still, only builders would be able to write it.  If you
need something more custom, you will have to expand on the functions you use.</p>
<h3 id="managing-wiki-pages-from-evennia">Managing wiki pages from Evennia<a class="headerlink" href="#managing-wiki-pages-from-evennia" title="Permanent link">&para;</a></h3>
<p>Unfortunately, Django wiki doesn't provide a clear and clean entry point to read and write articles from Evennia and it doesn't seem to be a very high priority.  If you really need to keep Django wiki and to create and manage wiki pages from your code, you can do so, but this article won't elaborate, as this is somewhat more technical.</p>
<p>However, it is a good opportunity to present a small project that has been created more recently: <a href="https://github.com/vincent-lg/evennia-wiki">evennia-wiki</a> has been created to provide a simple wiki, more tailored to Evennia and easier to connect.  It doesn't, as yet, provide as many options as does Django wiki, but it's perfectly usable:</p>
<ul>
<li>Pages have an inherent and much-easier to understand hierarchy based on URLs.</li>
<li>Article permissions are connected to Evennia groups and are much easier to accommodate specific requirements.</li>
<li>Articles can easily be created, read or updated from the Evennia code itself.</li>
<li>Markdown is fully-supported with a default integration to Bootstrap to look good on an Evennia website. Tables and table of contents are supported as well as wiki links.</li>
<li>The process to override wiki templates makes full use of the <code>template_overrides</code> directory.</li>
</ul>
<p>However evennia-wiki doesn't yet support:</p>
<ul>
<li>Images in markdown and the uploading schema.  If images are important to you, please consider contributing to this new project.</li>
<li>Modifying permissions on a per page/setting basis.</li>
<li>Moving pages to new locations.</li>
<li>Viewing page history.</li>
</ul>
<p>Considering the list of features in Django wiki, obviously other things could be added to the list.  However, these features may be the most important and useful.  Additional ones might not be that necessary.  If you're interested in supporting this little project, you are more than welcome to <a href="https://github.com/vincent-lg/evennia-wiki">contribute to it</a>.  Thanks!</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
