<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="./img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Tutorial: Tweeting Game Stats - Evennia Manual</title>
    <link href="./css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="./css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="./css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/bootstrap-3.3.7.min.js"></script>
    <script src="./js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '.';
      var is_top_frame = false;
        
        var pageToc = [
        ];

    </script>
    <script src="./js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <p><a href="A-tutorial-on-tweeting-game-stats-automatically."></a></p>
<p>This tutorial will create a simple script that will send a tweet to your already configured twitter account. Please see: <a href="https://github.com/evennia/evennia/wiki/How-to-connect-Evennia-to-Twitter">How to connect Evennia to Twitter</a> if you haven't already done so.</p>
<p>The script could be expanded to cover a variety of statistics you might wish to tweet about regularly, from player deaths to how much currency is in the economy etc.</p>
<pre><code class="python"># evennia/typeclasses/tweet_stats.py

import twitter
from random import randint
from django.conf import settings
from evennia import ObjectDB
from evennia import spawner
from evennia import logger
from evennia import DefaultScript

class TweetStats(DefaultScript):
    &quot;&quot;&quot;
    This implements the tweeting of stats to a registered twitter account
    &quot;&quot;&quot;

    # standard Script hooks 

    def at_script_creation(self):
        &quot;Called when script is first created&quot;

        self.key = &quot;tweet_stats&quot;
        self.desc = &quot;Tweets interesting stats about the game&quot;
        self.interval = 86400  # 1 day timeout
        self.start_delay = False

    def at_repeat(self):
        &quot;&quot;&quot;
        This is called every self.interval seconds to tweet interesting stats about the game.
        &quot;&quot;&quot;

        api = twitter.Api(consumer_key='consumer_key',
          consumer_secret='consumer_secret',
          access_token_key='access_token_key',
          access_token_secret='access_token_secret')

        number_tweet_outputs = 2

        tweet_output = randint(1, number_tweet_outputs)

        if tweet_output == 1:
        ##Game Chars, Rooms, Objects taken from @stats command
            nobjs = ObjectDB.objects.count()
            base_char_typeclass = settings.BASE_CHARACTER_TYPECLASS
            nchars = ObjectDB.objects.filter(db_typeclass_path=base_char_typeclass).count()
            nrooms = ObjectDB.objects.filter(db_location__isnull=True).exclude(db_typeclass_path=base_char_typeclass).count()
            nexits = ObjectDB.objects.filter(db_location__isnull=False, db_destination__isnull=False).count()
            nother = nobjs - nchars - nrooms - nexits
            tweet = &quot;Chars: %s, Rooms: %s, Objects: %s&quot; %(nchars, nrooms, nother)
        else: 
            if tweet_output == 2: ##Number of prototypes and 3 random keys - taken from @spawn command
                prototypes = spawner.spawn(return_prototypes=True)

                keys = prototypes.keys()
                nprots = len(prototypes)
                tweet = &quot;Prototype Count: %s  Random Keys: &quot; % nprots

                tweet += &quot; %s&quot; % keys[randint(0,len(keys)-1)]
                for x in range(0,2): ##tweet 3
                    tweet += &quot;, %s&quot; % keys[randint(0,len(keys)-1)]
        # post the tweet 
        try:
            response = api.PostUpdate(tweet)
        except:
            logger.log_trace(&quot;Tweet Error: When attempting to tweet %s&quot; % tweet)
</code></pre>

<p>In the <code>at_script_creation</code> method, we configure the script to fire immediately (useful for testing) and setup the delay (1 day) as well as script information seen when you use <code>@scripts</code></p>
<p>In the <code>at_repeat</code> method (which is called immediately and then at interval seconds later) we setup the Twitter API (just like in the initial configuration of twitter).  numberTweetOutputs is used to show how many different types of outputs we have (in this case 2).  We then build the tweet based on randomly choosing between these outputs.</p>
<ol>
<li>Shows the number of Player Characters, Rooms and Other/Objects</li>
<li>Shows the number of prototypes currently in the game and then selects 3 random keys to show </li>
</ol>
<p><a href="Scripts">Scripts Information</a> will show you how to add it as a Global script, however, for testing it may be useful to start/stop it quickly from within the game.  Assuming that you create the file as <code>mygame/typeclasses/tweet_stats.py</code> it can be started by using the following command </p>
<pre><code>@script Here = tweet_stats.TweetStats
</code></pre>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>