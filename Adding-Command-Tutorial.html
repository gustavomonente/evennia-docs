<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="./img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Adding Command Tutorial - Evennia Manual</title>
    <link href="./css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="./css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="./css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/bootstrap-3.3.7.min.js"></script>
    <script src="./js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '.';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Step 1: Creating a custom command", url: "#_top", children: [
          ]},
          {title: "Step 2: Adding the Command to a default Cmdset", url: "#step-2-adding-the-command-to-a-default-cmdset", children: [
          ]},
          {title: "Adding the command to specific object types", url: "#adding-the-command-to-specific-object-types", children: [
          ]},
          {title: "Change where Evennia looks for command sets", url: "#change-where-evennia-looks-for-command-sets", children: [
          ]},
        ];

    </script>
    <script src="./js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <p>This is a quick first-time tutorial expanding on the <a href="Commands.html">Commands</a> documentation. </p>
<p>Let's assume you have just downloaded Evennia, installed it and created your game folder (let's call
it just <code>mygame</code> here). Now you want to try to add a new command. This is the fastest way to do it. </p>
<h2 id="step-1-creating-a-custom-command">Step 1: Creating a custom command<a class="headerlink" href="#step-1-creating-a-custom-command" title="Permanent link">&para;</a></h2>
<ol>
<li>Open <code>mygame/commands/command.py</code> in a text editor. This is just one place commands could be placed but you get it setup from the onset as an easy place to start. It also already contains some example code.</li>
<li>Create a new class in <code>command.py</code> inheriting from <code>default_cmds.MuxCommand</code>. Let's call it
   <code>CmdEcho</code> in this example.</li>
<li>Set the class variable <code>key</code> to a good command name, like  <code>echo</code>.</li>
<li>Give your class a useful <em>docstring</em>. A docstring is the string at the very top of a class or function/method. The docstring at the top of the command class is read by Evennia to become the help entry for the Command (see
   <a href="Help-System#command-auto-help-system">Command Auto-help</a>).</li>
<li>Define a class method <code>func(self)</code> that echoes your input back to you. </li>
</ol>
<p>Below is an example how this all could look for the echo command:</p>
<pre><code class="python">        # file mygame/commands/command.py
        #[...]
        from evennia import default_cmds
        class CmdEcho(default_cmds.MuxCommand):
            &quot;&quot;&quot;
            Simple command example

            Usage: 
              echo [text]

            This command simply echoes text back to the caller.
            &quot;&quot;&quot;

            key = &quot;echo&quot;

            def func(self):
                &quot;This actually does things&quot; 
                if not self.args:
                    self.caller.msg(&quot;You didn't enter anything!&quot;)           
                else:
                    self.caller.msg(&quot;You gave the string: '%s'&quot; % self.args)
</code></pre>

<h2 id="step-2-adding-the-command-to-a-default-cmdset">Step 2: Adding the Command to a default Cmdset<a class="headerlink" href="#step-2-adding-the-command-to-a-default-cmdset" title="Permanent link">&para;</a></h2>
<p>The command is not available to use until it is part of a <a href="Command-Sets">Command Set</a>. In this
example we will go the easiest route and add it to the default Character commandset that already
exists. </p>
<ol>
<li>Edit <code>mygame/commands/default_cmdsets.py</code></li>
<li>Import your new command with  <code>from commands.command import CmdEcho</code>.</li>
<li>Add a line <code>self.add(CmdEcho())</code> to <code>CharacterCmdSet</code>, in the <code>at_cmdset_creation</code> method (the
   template tells you where). </li>
</ol>
<p>This is approximately how it should look at this point:</p>
<pre><code class="python">        # file mygame/commands/default_cmdsets.py
        #[...]
        from commands.command import CmdEcho
        #[...]
        class CharacterCmdSet(default_cmds.CharacterCmdSet):

            key = &quot;DefaultCharacter&quot;

            def at_cmdset_creation(self):

                # this first adds all default commands
                super(DefaultSet, self).at_cmdset_creation()

                # all commands added after this point will extend or 
                # overwrite the default commands.       
                self.add(CmdEcho())
</code></pre>

<p>Next, run the <code>@reload</code> command. You should now be able to use your new <code>echo</code> command from inside
the game. Use <code>help echo</code> to see the documentation for the command.</p>
<p>If you have trouble, make sure to check the log for error messages (probably due to syntax errors in
your command definition).</p>
<blockquote>
<p>Note: Typing <code>echotest</code> will also work. It will be handled as the command <code>echo</code> directly followed by
its argument <code>test</code> (which will end up in <code>self.args). To change this behavior, you can add the</code>arg_regex<code>property alongside</code>key<code>,</code>help_category` etc. <a href="Commands#on-arg_regex">See the arg_regex documentation</a> for more info. </p>
</blockquote>
<p>If you want to overload existing default commands (such as <code>look</code> or <code>get</code>), just add your new
command with the same key as the old one - it will then replace it. Just remember that you must use
<code>@reload</code> to see any changes. </p>
<p>See <a href="Commands.html">Commands</a> for many more details and possibilities when defining Commands and using
Cmdsets in various ways.</p>
<h2 id="adding-the-command-to-specific-object-types">Adding the command to specific object types<a class="headerlink" href="#adding-the-command-to-specific-object-types" title="Permanent link">&para;</a></h2>
<p>Adding your Command to the <code>CharacterCmdSet</code> is just one easy exapmple. The cmdset system is very
generic. You can create your own cmdsets (let's say in a module <code>mycmdsets.py</code>) and add them to
objects as you please (how to control their merging is described in detail in the <a href="Command-Sets">Command Set
documentation</a>).</p>
<pre><code class="python">    # file mygame/commands/mycmdsets.py
    #[...]
    from commands.command import CmdEcho
    from evennia import CmdSet
    #[...]
    class MyCmdSet(CmdSet):

        key = &quot;MyCmdSet&quot;

        def at_cmdset_creation(self):     
            self.add(CmdEcho())
</code></pre>

<p>Now you just need to add this to an object. To test things (as superuser) you can do</p>
<pre><code> @py self.cmdset.add("mycmdsets.MyCmdSet")
</code></pre>
<p>This will add this cmdset (along with its echo command) to yourself so you can test it. Note that
you cannot add a single Command to an object on its own, it must be part of a CommandSet in order to
do so.</p>
<p>The Command you added is not there permanently at this point. If you do a <code>@reload</code> the merger will
be gone. You <em>could</em> add the <code>permanent=True</code> keyword to the <code>cmdset.add</code> call. This will however
only make the new merged cmdset permanent on that <em>single</em> object. Often you want <em>all</em> objects of
this particular class to have this cmdset.</p>
<p>To make sure all new created objects get your new merged set, put the <code>cmdset.add</code> call in your
custom <a href="Typeclasses.html">Typeclasses</a>' <code>at_object_creation</code> method: </p>
<pre><code class="python">    # e.g. in mygame/typeclasses/objects.py

    from evennia import DefaultObject
    class MyObject(DefaultObject):

        def at_object_creation(self):
            &quot;called when the object is first created&quot;
            self.cmdset.add(&quot;mycmdset.MyCmdSet&quot;, permanent=True)
</code></pre>

<p>All new objects of this typeclass will now start with this cmdset and it will survive a <code>@reload</code>. </p>
<p><em>Note:</em> An important caveat with this is that <code>at_object_creation</code> is only called <em>once</em>, when the
object is first created. This means that if you already have existing objects in your databases
using that typeclass, they will not have been initiated the same way. There are many ways to update
them; since it's a one-time update you can usually just simply loop through them. As superuser, try
the following: </p>
<pre><code> @py from typeclasses.objects import MyObject; [o.cmdset.add("mycmdset.MyCmdSet") for o in MyObject.objects.all()]
</code></pre>
<p>This goes through all objects in your database having the right typeclass, adding the new cmdset to
each. The good news is that you only have to do this if you want to post-add <em>cmdsets</em>. If you just
want to add a new <em>command</em>, you can simply add that command to the cmdset's <code>at_cmdset_creation</code>
and <code>@reload</code> to make the Command immediately available.</p>
<h2 id="change-where-evennia-looks-for-command-sets">Change where Evennia looks for command sets<a class="headerlink" href="#change-where-evennia-looks-for-command-sets" title="Permanent link">&para;</a></h2>
<p>Evennia uses settings variables to know where to look for its default command sets. These are
normally not changed unless you want to re-organize your game folder in some way. For example, the
default character cmdset defaults to being defined as</p>
<pre><code>CMDSET_CHARACTER="commands.default_cmdset.CharacterCmdSet"
</code></pre>
<p>See <code>evennia/settings_default.py</code> for the other settings. </p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>