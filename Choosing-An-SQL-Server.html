<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="./img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Choosing An SQL Server - Evennia Manual</title>
    <link href="./css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="./css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="./css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/bootstrap-3.3.7.min.js"></script>
    <script src="./js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '.';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "SQLite3", url: "#_top", children: [
              {title: "Install of SQlite3", url: "#install-of-sqlite3" },
          ]},
          {title: "PostgreSQL", url: "#postgresql", children: [
              {title: "Install and initial setup of PostgreSQL", url: "#install-and-initial-setup-of-postgresql" },
              {title: "Evennia PostgreSQL configuration", url: "#evennia-postgresql-configuration" },
          ]},
          {title: "MySQL / MariaDB", url: "#mysql-mariadb", children: [
              {title: "Installing and initial setup of MySQL/MariaDB", url: "#installing-and-initial-setup-of-mysqlmariadb" },
          ]},
          {title: "Add MySQL configuration to Evennia", url: "#add-mysql-configuration-to-evennia", children: [
          ]},
          {title: "Others", url: "#others", children: [
          ]},
        ];

    </script>
    <script src="./js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <p><a href="Information-about-the-various-database-systems-which-are-supported."></a></p>
<p>This page gives an overview of the supported SQL databases as well as instructions on install:</p>
<ul>
<li>SQLite3 (default)</li>
<li>PostgreSQL</li>
<li>MySQL / MariaDB</li>
</ul>
<p>Since Evennia uses <a href="http://djangoproject.com">Django</a>, most of our notes are based off of what we know from the community and their documentation. While the information below may be useful, you can always find the most up-to-date and "correct" information at Django's <a href="http://docs.djangoproject.com/en/dev/ref/databases/#ref-databases">Notes about supported Databases</a> page.</p>
<h2 id="sqlite3">SQLite3<a class="headerlink" href="#sqlite3" title="Permanent link">&para;</a></h2>
<p><a href="https://sqlite.org/">SQLite3</a> is a light weight single-file database. It is our default database and Evennia will set this up for you automatically if you give no other options. SQLite stores the database in a single file (<code>mygame/server/evennia.db3</code>). This means it's very easy to reset this database - just delete (or move) that <code>evennia.db3</code> file and run <code>evennia migrate</code> again! No server process is needed and the administrative overhead and resource consumption is tiny. It is also very fast since it's run in-memory. For the vast majority of Evennia installs it will probably be all that's ever needed.  </p>
<p>SQLite will generally be much faster than MySQL/PostgreSQL but its performance comes with two drawbacks:</p>
<ul>
<li>SQLite <a href="https://www.sqlite.org/faq.html#q9">ignores length constraints by design</a>; it is possible to store very large strings and numbers in fields that technically should not accept them. This is not something you will notice; your game will read and write them and function normally, but this <em>can</em> create some data migration problems requiring careful thought if you do need to change databases later.</li>
<li>SQLite can scale well to storage of millions of objects, but if you end up with a thundering herd of users trying to access your MUD and web site at the same time, or you find yourself writing long-running functions to update large numbers of objects on a live game, either will yield errors and interference. SQLite does not work reliably with multiple concurrent threads or processes accessing its records. This has to do with file-locking clashes of the database file. So for a production server making heavy use of process- or thread pools (or when using a third-party webserver like Apache), a proper database is a more appropriate choice.</li>
</ul>
<h3 id="install-of-sqlite3">Install of SQlite3<a class="headerlink" href="#install-of-sqlite3" title="Permanent link">&para;</a></h3>
<p>This is installed and configured as part of Evennia. The database file is created as <code>mygame/server/evennia.db3</code> when you run </p>
<pre><code>evennia migrate
</code></pre>
<p>without changing any database options. An optional requirement is the <code>sqlite3</code> client program - this is required if you want to inspect the database data manually. A shortcut for using it with the evennia database is <code>evennia dbshell</code>. Linux users should look for the <code>sqlite3</code> package for their distro while Mac/Windows should get the <a href="https://sqlite.org/download.html">sqlite-tools package from this page</a>. </p>
<p>To inspect the default Evennia database (once it's been created), go to your game dir and do </p>
<pre><code class="bash">    sqlite3 server/evennia.db3
    # or 
    evennia dbshell
</code></pre>

<p>This will bring you into the sqlite command line. Use <code>.help</code> for instructions and <code>.quit</code> to exit. See <a href="https://gist.github.com/vincent178/10889334">here</a> for a cheat-sheet of commands.</p>
<h2 id="postgresql">PostgreSQL<a class="headerlink" href="#postgresql" title="Permanent link">&para;</a></h2>
<p><a href="https://www.postgresql.org/">PostgreSQL</a> is an open-source database engine, recommended by Django. While not as fast as SQLite for normal usage, it will scale better than SQLite, especially if your game has an very large database and/or extensive web presence through a separate server process.</p>
<h3 id="install-and-initial-setup-of-postgresql">Install and initial setup of PostgreSQL<a class="headerlink" href="#install-and-initial-setup-of-postgresql" title="Permanent link">&para;</a></h3>
<p>First, install the posgresql server. Version <code>9.6</code> is tested with Evennia. Packages are readily available for all distributions. You need to also get the <code>psql</code> client (this is called <code>postgresql-client</code> on debian-derived systems). Windows/Mac users can <a href="https://www.postgresql.org/download/">find what they need on the postgresql download page</a>. You should be setting up a password for your database-superuser (always called <code>postgres</code>) when you install. </p>
<p>For interaction with Evennia you need to also install <code>psycopg2</code> to your Evennia install (<code>pip install psycopg2-binary</code> in your virtualenv). This acts as the python bridge to the database server.</p>
<p>Next, start the postgres client:</p>
<pre><code class="bash">    psql -U postgres --password
</code></pre>

<blockquote>
<p>:warning: <strong>Warning:</strong> With the <code>--password</code> argument, Postgres should prompt you for a password. 
If it won't, replace that with <code>-p yourpassword</code> instead. Do not use the <code>-p</code> argument unless you have to since the resulting command, and your password, will be logged in the shell history.</p>
</blockquote>
<p>This will open a console to the postgres service using the psql client. </p>
<p>On the psql command line: </p>
<pre><code class="sql">CREATE USER evennia WITH PASSWORD 'somepassword';
CREATE DATABASE evennia;

# Postgres-specific optimizations
# https://docs.djangoproject.com/en/dev/ref/databases/#optimizing-postgresql-s-configuration
ALTER ROLE evennia SET client_encoding TO 'utf8';
ALTER ROLE evennia SET default_transaction_isolation TO 'read committed';
ALTER ROLE evennia SET timezone TO 'UTC';

GRANT ALL PRIVILEGES ON DATABASE evennia TO evennia;
\l       # list all databases and permissions
\q       # exit 
</code></pre>

<p><a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">Here</a> is a cheat-sheet for psql commands.</p>
<p>We create a database user 'evennia' and a new database named <code>evennia</code> (you can call them whatever you want though). We then grant the 'evennia' user full privileges to the new database so it can read/write etc to it. 
If you in the future wanted to completely wipe the database, an easy way to do is to log in as the <code>postgres</code> superuser again, then do <code>DROP DATABASE evennia;</code>, then <code>CREATE</code> and <code>GRANT</code> steps above again to recreate the database and grant privileges.</p>
<h3 id="evennia-postgresql-configuration">Evennia PostgreSQL configuration<a class="headerlink" href="#evennia-postgresql-configuration" title="Permanent link">&para;</a></h3>
<p>Edit `mygame/server/conf/secret_settings.py and add the following section: </p>
<pre><code class="python">#
# PostgreSQL Database Configuration
#
DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.postgresql_psycopg2',
            'NAME': 'evennia',
            'USER': 'evennia',
            'PASSWORD': 'somepassword',
            'HOST': 'localhost',
            'PORT': ''    # use default
        }}
</code></pre>

<p>If you used some other name for the database and user, enter those instead. Run</p>
<pre><code>evennia migrate
</code></pre>
<p>to populate your database. Should you ever want to inspect the database directly you can from now on also use</p>
<pre><code>evennia dbshell
</code></pre>
<p>as a shortcut to get into the postgres command line for the right database and user.</p>
<p>With the database setup you should now be able to start start Evennia normally with your new database.</p>
<h2 id="mysql-mariadb">MySQL / MariaDB<a class="headerlink" href="#mysql-mariadb" title="Permanent link">&para;</a></h2>
<p><a href="https://www.mysql.com/">MySQL</a> is a commonly used proprietary database system, on par with PostgreSQL. There is an open-source alternative called <a href="https://mariadb.org/">MariaDB</a> that mimics all functionality and command syntax of the former. So this section covers both. </p>
<h3 id="installing-and-initial-setup-of-mysqlmariadb">Installing and initial setup of MySQL/MariaDB<a class="headerlink" href="#installing-and-initial-setup-of-mysqlmariadb" title="Permanent link">&para;</a></h3>
<p>First, install and setup MariaDB or MySQL for your specific server. Linux users should look for the <code>mysql-server</code> or <code>mariadb-server</code> packages for their respective distributions. Windows/Mac users will find what they need from the <a href="https://www.mysql.com/downloads/">MySQL downloads</a> or <a href="https://mariadb.org/download/">MariaDB downloads</a> pages. You also need the respective database clients (<code>mysql</code>, <code>mariadb-client</code>), so you can setup the database itself. When you install the server you should usually be asked to set up the database root user and password.</p>
<p>You will finally also need a Python interface to allow Evennia to talk to the database. Django recommends the  <code>mysqlclient</code> one. Install this into the evennia virtualenv with <code>pip install mysqlclient</code>.</p>
<p>Start the database client (this is named the same for both mysql and mariadb):</p>
<pre><code class="bash">mysql -u root -p
</code></pre>

<p>You should get to enter your database root password (set this up when you installed the database server). </p>
<p>Inside the database client interface:</p>
<pre><code class="sql">CREATE USER 'evennia'@'localhost' IDENTIFIED BY 'somepassword';
CREATE DATABASE evennia;
ALTER DATABASE `evennia` CHARACTER SET utf8;      # note that it's `evennia` not 'evennia'!
GRANT ALL PRIVILEGES ON evennia.* TO 'evennia'@'localhost';
FLUSH PRIVILEGES;
exit
</code></pre>

<p><a href="https://gist.github.com/hofmannsven/9164408">Here</a> is a mysql command cheat sheet. </p>
<p>Above we created a new local user and database (we called both 'evennia' here, you can name them what you prefer). We set the character set to <code>utf8</code> to avoid an issue with prefix character length that can pop up on some installs otherwise. Next we grant the 'evennia' user all privileges on the <code>evennia</code> database and make sure the privileges are applied. Exiting the client brings us back to the normal terminal/console. </p>
<blockquote>
<p>Note: If you are not using MySQL for anything else you might consider granting the 'evennia' user full privileges with <code>GRANT ALL PRIVILEGES ON *.* TO 'evennia'@'localhost';</code>. If you do, it means you can use <code>evennia dbshell</code> later to connect to mysql, drop your database and re-create it as a way of easy reset. Without this extra privilege you will be able to drop the database but not re-create it without first switching to the database-root user.</p>
</blockquote>
<h2 id="add-mysql-configuration-to-evennia">Add MySQL configuration to Evennia<a class="headerlink" href="#add-mysql-configuration-to-evennia" title="Permanent link">&para;</a></h2>
<p>To tell Evennia to use your new database you need to edit <code>mygame/server/conf/settings.py</code> (or <code>secret_settings.py</code> if you don't want your db info passed around on git repositories).</p>
<blockquote>
<p>Note: The Django documentation suggests using an external <code>db.cnf</code> or other external conf-formatted file. Evennia users have however found that this leads to problems (see e.g. <a href="https://git.io/vQdiN">issue #1184</a>). To avoid trouble we recommend you simply put the configuration in your settings as below.</p>
</blockquote>
<pre><code class="python">    #
    # MySQL Database Configuration
    #
    DATABASES = {
       'default': {
           'ENGINE': 'django.db.backends.mysql',
           'NAME': 'evennia', 
           'USER': 'evennia', 
           'PASSWORD': 'somepassword', 
           'HOST': 'localhost',  # or an IP Address that your DB is hosted on
           'PORT': '', # use default port
       }
    }
</code></pre>

<p>Change this to fit your database setup. Next, run:</p>
<pre><code>evennia migrate
</code></pre>
<p>to populate your database. Should you ever want to inspect the database directly you can from now on also use</p>
<pre><code>evennia dbshell
</code></pre>
<p>as a shortcut to get into the postgres command line for the right database and user.</p>
<p>With the database setup you should now be able to start start Evennia normally with your new database.</p>
<h2 id="others">Others<a class="headerlink" href="#others" title="Permanent link">&para;</a></h2>
<p>No testing has been performed with Oracle, but it is also supported through Django. There are community maintained drivers for <a href="http://code.google.com/p/django-mssql/">MS SQL</a> and possibly a few others. If you try other databases out, consider expanding this page with instructions.</p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>