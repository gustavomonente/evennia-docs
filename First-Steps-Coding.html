<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="./img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>First Steps Coding - Evennia Manual</title>
    <link href="./css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="./css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="./css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/bootstrap-3.3.7.min.js"></script>
    <script src="./js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '.';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Your First Changes", url: "#_top", children: [
              {title: "Tweak Default Character", url: "#tweak-default-character" },
              {title: "Add a New Default Command", url: "#add-a-new-default-command" },
              {title: "Make a New Type of Object", url: "#make-a-new-type-of-object" },
          ]},
          {title: "Where to Go From Here?", url: "#where-to-go-from-here", children: [
          ]},
        ];

    </script>
    <script src="./js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <p>This section gives a brief step-by-step introduction on how to set up Evennia for the first time so you can modify and overload the defaults easily. You should only need to do these steps once. It also walks through you making your first few tweaks.</p>
<p>Before continuing, make sure you have Evennia installed and running by following the <a href="Getting-Started">Getting Started</a> instructions. You should have initialized a new game folder with the <code>evennia --init foldername</code> command.  We will in the following assume this folder is called "mygame".</p>
<p>It might be a good idea to eye through the brief <a href="Coding-Introduction">Coding Introduction</a> too (especially the recommendations in the section about the evennia "flat" API and about using <code>evennia shell</code> will help you here and in the future).</p>
<p>To follow this tutorial you also need to know the basics of operating your computer's terminal/command line. You also need to have a text editor to edit and create source text files. There are plenty of online tutorials on how to use the terminal and plenty of good free text editors. We will assume these things are already familiar to you henceforth.</p>
<h2 id="your-first-changes">Your First Changes<a class="headerlink" href="#your-first-changes" title="Permanent link">&para;</a></h2>
<p>Below are some first things to try with your new custom modules. You can test these to get a feel for the system. See also <a href="Tutorials.html">Tutorials</a> for more step-by-step help and special cases.</p>
<h3 id="tweak-default-character">Tweak Default Character<a class="headerlink" href="#tweak-default-character" title="Permanent link">&para;</a></h3>
<p>We will add some simple rpg attributes to our default Character. In the next section we will follow up with a new command to view those attributes.</p>
<ol>
<li>
<p>Edit <code>mygame/typeclasses/characters.py</code> and modify the <code>Character</code> class.  The <code>at_object_creation</code> method also exists on the <code>DefaultCharacter</code> parent and will overload it. The <code>get_abilities</code> method is unique to our version of <code>Character</code>.</p>
<p>```python
class Character(DefaultCharacter):
    # [...]
    def at_object_creation(self):
        """
        Called only at initial creation. This is a rather silly
        example since ability scores should vary from Character to
        Character and is usually set during some character
        generation step instead.
        """
        #set persistent attributes
        self.db.strength = 5
        self.db.agility = 4
        self.db.magic = 2</p>
<pre><code>def get_abilities(self):
    """
    Simple access method to return ability
    scores as a tuple (str,agi,mag)
    """
    return self.db.strength, self.db.agility, self.db.magic
</code></pre>
<p>```</p>
</li>
<li>
<p><a href="Start-Stop-Reload">Reload</a> the server (you will still be connected to the game after doing this). Note that if you examine <em>yourself</em> you will <em>not</em> see any new Attributes appear yet. Read the next section to understand why.</p>
</li>
</ol>
<h4 id="updating-yourself">Updating Yourself<a class="headerlink" href="#updating-yourself" title="Permanent link">&para;</a></h4>
<p>It's important to note that the new <a href="Attributes.html">Attributes</a> we added above will only be stored on <em>newly</em> created characters. The reason for this is simple: The <code>at_object_creation</code> method, where we added those Attributes, is per definition only called when the object is <em>first created</em>, then never again. This is usually a good thing since those Attributes may change over time - calling that hook would reset them back to start values. But it also means that your existing character doesn't have them yet. You can see this by calling the <code>get_abilities</code> hook on yourself at this point:</p>
<pre><code># (you have to be superuser to use @py)
@py self.get_abilities()
&lt;&lt;&lt; (None, None, None)
</code></pre>

<p>This is easily remedied.</p>
<pre><code>@update self
</code></pre>

<p>This will (only) re-run <code>at_object_creation</code> on yourself. You should henceforth be able to get the abilities successfully:</p>
<pre><code>@py self.get_abilities()
&lt;&lt;&lt; (5, 4, 2)
</code></pre>

<p>This is something to keep in mind if you start building your world before your code is stable - startup-hooks will not (and should not) automatically run on <em>existing</em> objects - you have to update your existing objects manually. Luckily this is a one-time thing and pretty simple to do. If the typeclass you want to update is in <code>typeclasses.myclass.MyClass</code>, you can do the following (e.g. from <code>evennia shell</code>):</p>
<pre><code class="python">from typeclasses.myclass import MyClass
# loop over all MyClass instances in the database
# and call .swap_typeclass on them
for obj in MyClass.objects.all():
    obj.swap_typeclass(MyClass, run_start_hooks=&quot;at_object_creation&quot;)
</code></pre>

<p>Using <code>swap_typeclass</code> to the same typeclass we already have will re-run the creation hooks (this is what the <code>@update</code> command does under the hood). From in-game you can do the same with <code>@py</code>:</p>
<pre><code>@py typeclasses.myclass import MyClass;[obj.swap_typeclass(MyClass) for obj in MyClass.objects.all()]
</code></pre>

<p>See the <a href="Adding-Object-Typeclass-tutorial">Object Typeclass tutorial</a> for more help and the <a href="Typeclasses.html">Typeclasses</a> and <a href="Attributes.html">Attributes</a> page for detailed documentation about Typeclasses and Attributes.</p>
<h4 id="troubleshooting-updating-yourself">Troubleshooting: Updating Yourself<a class="headerlink" href="#troubleshooting-updating-yourself" title="Permanent link">&para;</a></h4>
<p>One may experience errors for a number of reasons. Common beginner errors are spelling mistakes, wrong indentations or code omissions leading to a <code>SyntaxError</code>. Let's say you leave out a colon from the end of a class function like so: <code>def at_object_creation(self)</code>. The client will reload without issue. <em>However</em>, if you look at the terminal/console (i.e. not in-game), you will see Evennia complaining (this is called a <em>traceback</em>):</p>
<pre><code>Traceback (most recent call last):
File &quot;C:\mygame\typeclasses\characters.py&quot;, line 33
     def at_object_creation(self)
                                 ^
SyntaxError: invalid syntax
</code></pre>

<p>Evennia will still be restarting and following the tutorial, doing <code>@py self.get_abilities()</code> will return the right response <code>(None, None, None)</code>. But when attempting to <code>@typeclass/force self</code> you will get this response:</p>
<pre><code class="python">    AttributeError: 'DefaultObject' object has no attribute 'get_abilities'
</code></pre>

<p>The full error will show in the terminal/console but this is confusing since you did add <code>get_abilities</code> before. Note however what the error says - you (<code>self</code>) should be a <code>Character</code> but the error talks about <code>DefaultObject</code>. What has happened is that due to your unhandled <code>SyntaxError</code> earlier, Evennia could not load the <code>character.py</code> module at all (it's not valid Python). Rather than crashing, Evennia handles this by temporarily falling back to a safe default -  <code>DefaultObject</code> - in order to keep your MUD running. Fix the original <code>SyntaxError</code> and reload the server. Evennia will then be able to use your modified <code>Character</code> class again and things should work.</p>
<blockquote>
<p>Note: Learning how to interpret an error traceback is a critical skill for anyone learning Python. Full tracebacks will appear in the terminal/Console you started Evennia from. The traceback text can sometimes be quite long, but you are usually just looking for the last few lines: The description of the error and the filename + line number for where the error occurred. In the example above, we see it's a <code>SyntaxError</code> happening at <code>line 33</code> of <code>mygame\typeclasses\characters.py</code>. In this case it even points out <em>where</em> on the line it encountered the error (the missing colon). Learn to read tracebacks and you'll be able to resolve the vast majority of common errors easily.</p>
</blockquote>
<h3 id="add-a-new-default-command">Add a New Default Command<a class="headerlink" href="#add-a-new-default-command" title="Permanent link">&para;</a></h3>
<p>The <code>@py</code> command used above is only available to privileged users. We want any player to be able to see their stats.  Let's add a new <a href="Commands.html">command</a> to list the abilities we added in the previous section.</p>
<ol>
<li>
<p>Open <code>mygame/commands/command.py</code>. You could in principle put your command anywhere but this module has all the imports already set up along with some useful documentation. Make a new class at the bottom of this file:</p>
<p>```python
    class CmdAbilities(Command):
        """
        List abilities</p>
<pre><code>    Usage:
      abilities

    Displays a list of your current ability values.
    """
    key = "abilities"
    aliases = ["abi"]
    lock = "cmd:all()"
    help_category = "General"

    def func(self):
        "implements the actual functionality"

         str, agi, mag = self.caller.get_abilities()
         string = "STR: %s, AGI: %s, MAG: %s" % (str, agi, mag)
         self.caller.msg(string)
</code></pre>
<p>```</p>
</li>
<li>
<p>Next you edit <code>mygame/commands/default_cmdsets.py</code> and add a new import to it near the top:</p>
<p><code>python
    from commands.command import CmdAbilities</code></p>
</li>
<li>
<p>In the <code>CharacterCmdSet</code> class, add the following near the bottom (it says where):</p>
<p><code>python
    self.add(CmdAbilities())</code></p>
</li>
<li>
<p><a href="Start-Stop-Reload">Reload</a> the server (noone will be disconnected by doing this).</p>
</li>
</ol>
<p>You (and anyone else) should now be able to use <code>abilities</code> (or its alias <code>abi</code>) as part of your normal commands in-game:</p>
<pre><code>abilities
STR: 5, AGI: 4, MAG: 2
</code></pre>

<p>See the <a href="Adding-Command-Tutorial">Adding a Command tutorial</a> for more examples and the <a href="Commands.html">Commands</a> section for detailed documentation about the Command system.</p>
<h3 id="make-a-new-type-of-object">Make a New Type of Object<a class="headerlink" href="#make-a-new-type-of-object" title="Permanent link">&para;</a></h3>
<p>Let's test to make a new type of object. This example is an "wise stone" object that returns some random comment when you look at it, like this:</p>
<pre><code>&gt; look stone

A very wise stone

This is a very wise old stone.
It grumbles and says: 'The world is like a rock of chocolate.'
</code></pre>
<ol>
<li>Create a new module in <code>mygame/typeclasses/</code>. Name it <code>wiseobject.py</code> for this example.</li>
<li>In the module import the base <code>Object</code> (<code>typeclasses.objects.Object</code>). This is empty by default, meaning it is just a proxy for the default <code>evennia.DefaultObject</code>.</li>
<li>
<p>Make a new class in your module inheriting from <code>Object</code>. Overload hooks on it to add new functionality. Here is an example of how the file could look:</p>
<p>```python
from random import choice
from typeclasses.objects import Object</p>
<p>class WiseObject(Object):
    """
    An object speaking when someone looks at it. We
    assume it looks like a stone in this example.
    """
    def at_object_creation(self):
        "Called when object is first created"
        self.db.wise_texts = \
               ["Stones have feelings too.",
                "To live like a stone is to not have lived at all.",
                "The world is like a rock of chocolate."]</p>
<pre><code>def return_appearance(self, looker):
    """
    Called by the look command. We want to return
    a wisdom when we get looked at.
    """
    # first get the base string from the
    # parent's return_appearance.
    string = super().return_appearance(looker)
    wisewords = "\n\nIt grumbles and says: '%s'"
    wisewords = wisewords % choice(self.db.wise_texts)
    return string + wisewords
</code></pre>
<p>```</p>
</li>
<li>
<p>Check your code for bugs. Tracebacks will appear on your command line or log. If you have a grave Syntax Error in your code, the source file itself will fail to load which can cause issues with the entire cmdset. If so, fix your bug and <a href="Start-Stop-Reload">reload the server from the command line</a> (noone will be disconnected by doing this).</p>
</li>
<li>Use <code>@create/drop stone:wiseobject.WiseObject</code> to create a talkative stone. If the <code>@create</code> command spits out a warning or cannot find the typeclass (it will tell you which paths it searched), re-check your code for bugs and that you gave the correct path. The <code>@create</code> command starts looking for Typeclasses in <code>mygame/typeclasses/</code>.</li>
<li>Use <code>look stone</code> to test. You will see the default description ("You see nothing special") followed by a random message of stony wisdom. Use <code>@desc stone = This is a wise old stone.</code> to make it look nicer. See the <a href="Builder-Docs">Builder Docs</a> for more information.</li>
</ol>
<p>Note that <code>at_object_creation</code> is only called once, when the stone is first created. If you make changes to this method later, already existing stones will not see those changes. As with the <code>Character</code> example above you can use <code>@typeclass/force</code> to tell the stone to re-run its initialization.</p>
<p>The <code>at_object_creation</code> is a special case though. Changing most other aspects of the typeclass does <em>not</em> require manual updating like this - you just need to <code>@reload</code> to have all changes applied automatically to all existing objects.</p>
<h2 id="where-to-go-from-here">Where to Go From Here?<a class="headerlink" href="#where-to-go-from-here" title="Permanent link">&para;</a></h2>
<p>There are more <a href="Tutorials.html">Tutorials</a>, including one for building a <a href="Tutorial-for-basic-MUSH-like-game">whole little MUSH-like game</a> - that is instructive also if you have no interest in MUSHes per se. A good idea is to also get onto the <a href="http://webchat.freenode.net/?channels=evennia">IRC chat</a> and the <a href="https://groups.google.com/forum/#!forum/evennia">mailing list</a> to get in touch with the community and other developers.</p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>