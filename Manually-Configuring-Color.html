<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Manually Configuring Color - Evennia Manual</title>
        <link href="css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">Evennia Manual</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="index.html">Home</a>
                            </li>
                            <li >
                                <a href="Administrative-Docs.html">Admin</a>
                            </li>
                            <li >
                                <a href="Builder-Docs.html">Building</a>
                            </li>
                            <li >
                                <a href="Developer-Central.html">Game Development</a>
                            </li>
                            <li >
                                <a href="Tutorials.html">Tutorials</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#setting-up-a-custom-typeclass">Setting up a custom Typeclass</a></li>
        <li class="main "><a href="#overload-the-msg-method">Overload the msg() method</a></li>
        <li class="main "><a href="#custom-color-config-command">Custom color config command</a></li>
        <li class="main "><a href="#more-colors">More colors</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>This is a small tutorial for customizing your character objects, using the example of letting users turn on and off ANSI color parsing as an example.  <code>@options NOCOLOR=True</code> will now do what this tutorial shows, but the tutorial subject can be applied to other toggles you may want, as well.</p>
<p>In the Building guide's <a href="https://github.com/evennia/evennia/wiki/TextTags#coloured-text">Colors</a> page you can learn how to add color to your game by using special markup. Colors enhance the gaming experience, but not all users want color. Examples would be users working from clients that don't support color, or people with various seeing disabilities that rely on screen readers to play your game. Also, whereas Evennia normally automatically detects if a client supports color, it may get it wrong. Being able to turn it on manually if you know it <strong>should</strong> work could be a nice feature.</p>
<p>So here's how to allow those users to remove color. It basically means you implementing a simple configuration system for your characters. This is the basic sequence:</p>
<ol>
<li>Define your own default character typeclass, inheriting from Evennia's default.</li>
<li>Set an attribute on the character to control markup on/off.</li>
<li>Set your custom character class to be the default for new accounts.</li>
<li>Overload the <code>msg()</code> method on the typeclass and change how it uses markup.</li>
<li>Create a custom command to allow users to change their setting.</li>
</ol>
<h2 id="setting-up-a-custom-typeclass">Setting up a custom Typeclass<a class="headerlink" href="#setting-up-a-custom-typeclass" title="Permanent link">&para;</a></h2>
<p>Create a new module in <code>mygame/typeclasses</code> named, for example, <code>mycharacter.py</code>. Alternatively you can simply add a new class to 'mygamegame/typeclasses/characters.py'.</p>
<p>In your new module(or characters.py), create a new <a href="../typeclasses">Typeclass</a> inheriting from <code>evennia.DefaultCharacter</code>. We will also import <code>evennia.utils.ansi</code>, which we will use later.</p>
<pre><code class="python">    from evennia import Character
    from evennia.utils import ansi

    class ColorableCharacter(Character):
        at_object_creation(self):
            # set a color config value
            self.db.config_color = True
</code></pre>

<p>Above we set a simple config value as an <a href="../Attributes">Attribute</a>.</p>
<p>Let's make sure that new characters are created of this type. Edit your <code>mygame/server/conf/settings.py</code> file and add/change <code>BASE_CHARACTER_TYPECLASS</code> to point to your new character class. Observe that this will only affect <em>new</em> characters, not those already created. You have to convert already created characters to the new typeclass by using the <code>@typeclass</code> command (try on a secondary character first though, to test that everything works - you don't want to render your root user unusable!).</p>
<pre><code> @typeclass/reset/force Bob = mycharacter.ColorableCharacter
</code></pre>
<p><code>@typeclass</code> changes Bob's typeclass and runs all its creation hooks all over again. The <code>/reset</code> switch clears all attributes and properties back to the default for the new typeclass - this is useful in this case to avoid ending up with an object having a "mixture" of properties from the old typeclass and the new one. <code>/force</code> might be needed if you edit the typeclass and want to update the object despite the actual typeclass name not having changed.</p>
<h2 id="overload-the-msg-method">Overload the <code>msg()</code> method<a class="headerlink" href="#overload-the-msg-method" title="Permanent link">&para;</a></h2>
<p>Next we need to overload the <code>msg()</code> method. What we want is to check the configuration value before calling the main function.  The original <code>msg</code> method call is seen in <code>evennia/objects/objects.py</code> and is called like this:</p>
<pre><code class="python">    msg(self, text=None, from_obj=None, session=None, options=None, **kwargs):
</code></pre>

<p>As long as we define a method on our custom object with the same name and keep the same number of arguments/keywords we will overload the original. Here's how it could look:</p>
<pre><code class="python">    class ColorableCharacter(Character):
        # [...]
        msg(self, text=None, from_obj=None, session=None, options=None,
            **kwargs):
            &quot;our custom msg()&quot;
            if self.db.config_color is not None: # this would mean it was not set
                if not self.db.config_color:
                    # remove the ANSI from the text
                    text = ansi.strip_ansi(text)
            super().msg(text=text, from_obj=from_obj,
                                               session=session, **kwargs)
</code></pre>

<p>Above we create a custom version of the <code>msg()</code> method. If the configuration Attribute is set, it strips the ANSI from the text it is about to send, and then calls the parent <code>msg()</code> as usual. You need to <code>@reload</code> before your changes become visible.</p>
<p>There we go! Just flip the attribute <code>config_color</code> to False and your users will not see any color. As superuser (assuming you use the Typeclass <code>ColorableCharacter</code>) you can test this with the <code>@py</code> command:</p>
<pre><code> @py self.db.config_color = False
</code></pre>
<h2 id="custom-color-config-command">Custom color config command<a class="headerlink" href="#custom-color-config-command" title="Permanent link">&para;</a></h2>
<p>For completeness, let's add a custom command so users can turn off their color display themselves if they want.</p>
<p>In <code>mygame/commands</code>, create a new file, call it for example <code>configcmds.py</code> (it's likely that you'll want to add other commands for configuration down the line). You can also copy/rename the command template.</p>
<pre><code class="python">    from evennia import Command

    class CmdConfigColor(Command):
        &quot;&quot;&quot;
        Configures your color

        Usage:
          @togglecolor on|off

        This turns ANSI-colors on/off.
        Default is on.
        &quot;&quot;&quot;

        key = &quot;@togglecolor&quot;
        aliases = [&quot;@setcolor&quot;]

        def func(self):
            &quot;implements the command&quot;
            # first we must remove whitespace from the argument
            self.args = self.args.strip()
            if not self.args or not self.args in (&quot;on&quot;, &quot;off&quot;):
                self.caller.msg(&quot;Usage: @setcolor on|off&quot;)
                return
            if self.args == &quot;on&quot;:
                self.caller.db.config_color = True
                # send a message with a tiny bit of formatting, just for fun
                self.caller.msg(&quot;Color was turned |won|W.&quot;)
            else:
                self.caller.db.config_color = False
                self.caller.msg(&quot;Color was turned off.&quot;)
</code></pre>

<p>Lastly, we make this command available to the user by adding it to the default <code>CharacterCmdSet</code> in <code>mygame/commands/default_cmdsets.py</code> and reloading the server. Make sure you also import the command:</p>
<pre><code class="python">from mygame.commands import configcmds
class CharacterCmdSet(default_cmds.CharacterCmdSet):
    # [...]
    def at_cmdset_creation(self):
        &quot;&quot;&quot;
        Populates the cmdset
        &quot;&quot;&quot;
        super().at_cmdset_creation()
        #
        # any commands you add below will overload the default ones.
        #

        # here is the only line that we edit
        self.add(configcmds.CmdConfigColor())
</code></pre>

<h2 id="more-colors">More colors<a class="headerlink" href="#more-colors" title="Permanent link">&para;</a></h2>
<p>Apart from ANSI colors, Evennia also supports <strong>Xterm256</strong> colors (See <a href="../TextTags#colored-text">Colors</a>). The <code>msg()</code> method supports the <code>xterm256</code> keyword for manually activating/deactiving xterm256. It should be easy to expand the above example to allow players to customize xterm256 regardless of if Evennia thinks their client supports it or not.</p>
<p>To get a better understanding of how <code>msg()</code> works with keywords, you can try this as superuser:</p>
<pre><code>@py self.msg("|123Dark blue with xterm256, bright blue with ANSI", xterm256=True)
@py self.msg("|gThis should be uncolored", nomarkup=True)
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
