<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Security - Evennia Manual</title>
        <link href="css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">Evennia Manual</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="index.html">Home</a>
                            </li>
                            <li >
                                <a href="Administrative-Docs.html">Admin</a>
                            </li>
                            <li >
                                <a href="Builder-Docs.html">Building</a>
                            </li>
                            <li >
                                <a href="Developer-Central.html">Game Development</a>
                            </li>
                            <li >
                                <a href="Tutorials.html">Tutorials</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#know-your-logs">Know your logs</a></li>
        <li class="main "><a href="#disable-developmentdebugging-options">Disable development/debugging options</a></li>
        <li class="main "><a href="#handle-user-uploaded-images-with-care">Handle user-uploaded images with care</a></li>
        <li class="main "><a href="#disable-the-web-interface">Disable the web interface</a></li>
        <li class="main "><a href="#change-your-ssh-port">Change your ssh port</a></li>
        <li class="main "><a href="#set-up-a-firewall">Set up a firewall</a></li>
        <li class="main "><a href="#use-an-external-webserver">Use an external webserver</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>If you're considering deploying to a cloud-based host, you have a vested interest in securing your applications-- you likely have a credit card on file that your host can freely bill. Hackers pegging your CPU to mine cryptocurrency or saturating your network connection to participate in a botnet or send spam can run up your hosting bill, get your service suspended or get your address/site blacklisted by ISPs. It can be a difficult legal or political battle to undo this damage after the fact.</p>
<p>As a developer about to expose a web application to the threat landscape of the modern internet, here are a few tips to consider to increase the security of your Evennia install.</p>
<h3 id="know-your-logs">Know your logs<a class="headerlink" href="#know-your-logs" title="Permanent link">&para;</a></h3>
<p>In case of emergency, check your logs! By default they are located in the <code>server/logs/</code> folder. Here are some of the more important ones and why you should care:</p>
<ul>
<li><code>http_requests.log</code> will show you what HTTP requests have been made against Evennia's built-in webserver (TwistedWeb). This is a good way to see if people are innocuously browsing your site or trying to break it through code injection.</li>
<li><code>portal.log</code> will show you various networking-related information. This is a good place to check for odd or unusual types or amounts of connections to your game, or other networking-related issues-- like when users are reporting an inability to connect.</li>
<li><code>server.log</code> is the MUX administrator's best friend. Here is where you'll find information pertaining to who's trying to break into your system by guessing at passwords, who created what objects, and more. If your game fails to start or crashes and you can't tell why, this is the first place you should look for answers. Security-related events are prefixed with an <code>[SS]</code> so when there's a problem you might want to pay special attention to those.</li>
</ul>
<h3 id="disable-developmentdebugging-options">Disable development/debugging options<a class="headerlink" href="#disable-developmentdebugging-options" title="Permanent link">&para;</a></h3>
<p>There are a few Evennia/Django options that are set when you first create your game to make it more obvious to you where problems arise. These options should be disabled before you push your game into production-- leaving them on can expose variables or code someone with malicious intent can easily abuse to compromise your environment.</p>
<p>In <code>server/conf/settings.py</code>:</p>
<pre><code># Disable Django's debug mode
DEBUG = False
# Disable the in-game equivalent
IN_GAME_ERRORS = False
# If you've registered a domain name, force Django to check host headers. Otherwise leave this as-is.
# Note the leading period-- it is not a typo!
ALLOWED_HOSTS = ['.example.com']
</code></pre>
<h3 id="handle-user-uploaded-images-with-care">Handle user-uploaded images with care<a class="headerlink" href="#handle-user-uploaded-images-with-care" title="Permanent link">&para;</a></h3>
<p>If you decide to allow users to upload their own images to be served from your site, special care must be taken. Django will read the file headers to confirm it's an image (as opposed to a document or zip archive), but <a href="https://insinuator.net/2014/05/django-image-validation-vulnerability/">code can be injected into an image file</a> <em>after</em> the headers that can be interpreted as HTML and/or give an attacker a web shell through which they can access other filesystem resources.</p>
<p><a href="https://docs.djangoproject.com/en/dev/topics/security/#user-uploaded-content-security">Django has a more comprehensive overview of how to handle user-uploaded files</a>, but in short you should take care to do one of two things--</p>
<ul>
<li>Serve all user-uploaded assets from a <em>separate</em> domain or CDN (<em>not</em> a subdomain of the one you already have!). For example, you may be browsing <code>reddit.com</code> but note that all the user-submitted images are being served from the <code>redd.it</code> domain. There are both security and performance benefits to this (webservers tend to load local resources one-by-one, whereas they will request external resources in bulk).</li>
<li>If you don't want to pay for a second domain, don't understand what any of this means or can't be bothered with additional infrastructure, then simply reprocess user images upon receipt using an image library. Convert them to a different format, for example. <em>Destroy the originals!</em></li>
</ul>
<h3 id="disable-the-web-interface">Disable the web interface<a class="headerlink" href="#disable-the-web-interface" title="Permanent link">&para;</a></h3>
<p>The web interface allows visitors to see an informational page as well as log into a browser-based
telnet client with which to access Evennia. It also provides authentication endpoints against which an attacker can attempt to validate stolen lists of credentials to see which ones might be shared by your users. Django's security is robust, but if you don't want/need these features and fully intend to force your users to use traditional clients to access your game, you might consider disabling either/both to minimize your attack surface.</p>
<p>In <code>server/conf/settings.py</code>:</p>
<pre><code># Disable the Javascript webclient
WEBCLIENT_ENABLED = False
# Disable the website altogether
WEBSERVER_ENABLED = False
</code></pre>
<h3 id="change-your-ssh-port">Change your ssh port<a class="headerlink" href="#change-your-ssh-port" title="Permanent link">&para;</a></h3>
<p>Automated attacks will often target port 22 seeing as how it's the standard port for SSH traffic. Also,
many public wifi hotspots block ssh traffic over port 22 so you might not be able to access your
server from these locations if you like to work remotely or don't have a home internet connection.</p>
<p>If you don't intend on running a website or securing it with TLS, you can mitigate both problems by changing the port used for ssh to 443, which most/all hotspot providers assume is HTTPS traffic and allows through.</p>
<p>(Ubuntu) In /etc/ssh/sshd_config, change the following variable:</p>
<pre><code># What ports, IPs and protocols we listen for
Port 443
</code></pre>
<p>Save, close, then run the following command:</p>
<pre><code>sudo service ssh restart
</code></pre>
<h3 id="set-up-a-firewall">Set up a firewall<a class="headerlink" href="#set-up-a-firewall" title="Permanent link">&para;</a></h3>
<p>Ubuntu users can make use of the simple ufw utility. Anybody else can use iptables.</p>
<pre><code># Install ufw (if not already)
sudo apt-get install ufw
</code></pre>
<p>UFW's default policy is to deny everything. We must specify what we want to allow through our firewall.</p>
<pre><code># Allow terminal connections to your game
sudo ufw allow 4000/tcp
# Allow browser connections to your website
sudo ufw allow 4001/tcp
</code></pre>
<p>Use ONE of the next two commands depending on which port your ssh daemon is listening on:</p>
<pre><code>sudo ufw allow 22/tcp
sudo ufw allow 443/tcp
</code></pre>
<p>Finally:</p>
<pre><code>sudo ufw enable
</code></pre>
<p>Now the only ports open will be your administrative ssh port (whichever you chose), and Evennia on 4000-4001.</p>
<h3 id="use-an-external-webserver">Use an external webserver<a class="headerlink" href="#use-an-external-webserver" title="Permanent link">&para;</a></h3>
<p>Though not officially supported, there are some benefits to <a href="https://github.com/evennia/evennia/wiki/Apache-Config">deploying a webserver</a> to handle/proxy traffic to your Evennia instance.</p>
<p>For example, Evennia's game engine and webservice are tightly integrated. If you bring your game down for maintenance (or if it simply crashes) your website will go down with it. In these cases a standalone webserver can still be used to display a maintenance page or otherwise communicate to your users the reason for the downtime, instead of disappearing off the face of the earth and returning opaque <code>SERVER NOT FOUND</code> error messages.</p>
<p>Proper webservers are also written in more efficient programming languages than Python, and while Twisted can handle its own, putting a webserver in front of it is like hiring a bouncer to deal with nuisances and crowds before they even get in the door.</p>
<p>Many of the popular webservers also let you plug in additional modules (like <a href="https://en.wikipedia.org/wiki/ModSecurity">mod_security</a> for Apache) that can be used to detect (and block!) malicious users or requests before they even touch your game or site. There are also automated solutions for installing and configuring TLS (via <a href="https://en.wikipedia.org/wiki/Let%27s_Encrypt">Certbot/Let's Encrypt</a>) to secure your website against hotspot and ISP snooping.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
